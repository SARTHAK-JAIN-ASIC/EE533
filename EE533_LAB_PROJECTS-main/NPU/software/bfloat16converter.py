import struct

def float32_to_bfloat16(value):
    packed = struct.pack('>f', value)
    int_val = struct.unpack('>I', packed)[0]
    upper = int_val >> 16
    lower = int_val & 0xFFFF

    if lower > 0x8000 or (lower == 0x8000 and (upper & 1)):
        upper += 1

    return upper & 0xFFFF

def convert_and_write_to_file(float_values, filename):
    with open(filename, 'w') as f:
        for value in float_values:
            b16 = float32_to_bfloat16(value)
            hex_str = f"{b16:04X}"
            f.write(f"{hex_str}\n")

# Example usage
float_values = [0.07861, -0.08704, 0.27686, 0.59229, 0.85352, 1.25488, -0.20520, -0.05872, 0.01170, -0.56445, -0.49707, -0.29980, 0.82471, 0.63379, 0.67383, -0.07617, 0.03008, 1.45801, -1.22949, -0.28320, 1.12695, 0.84180, -0.80273, -0.05289, 0.02313, 0.99658, -1.39160, 0.74268, 0.60791, -1.76660, -0.72510, 0.09753, 0.04382, -0.09412, 0.29688, -1.65137, -0.63037, 0.65479, -0.77979, 0.08502, 0.09528, 0.17517, -2.21680, -0.53076, -0.09637, 0.76123, 0.23877, -0.10284, 0.00778, 0.31641, -1.13672, -1.57812, 0.91357, 1.29785, 1.15234, 0.27783, 0.01357, 0.03806, 0.25391, -0.96631, 0.21362, -0.10266, 0.50293, 0.00570,
-0.01610, 0.07727, 0.13171, -0.45825, 0.14099, -0.41309, -0.08392, -0.11218, 0.01234, -0.04434, 0.46265, 0.13049, -0.64844, -0.50684, -0.24304, -0.10065, 0.12146, 0.66064, 0.34888, 0.05270, 0.07800, -0.56104, -0.11572, -0.08234, -0.09784, 0.24353, 0.18884, -0.07318, 0.30469, -0.41431, 0.08698, 0.11316, -0.00560, 0.01845, -0.76221, -0.45239, -0.18469, 0.49805, -0.05612, 0.06329, 0.11053, 0.19458, -0.36621, -0.76758, -0.66553, 0.01759, -0.07684, 0.01517, 0.09912, 0.27026, 1.35059, 0.78174, -0.12671, 0.07452, -0.23462, -0.10809, -0.03317, -0.01788, -0.08832, 0.07806, 0.65234, 0.40088, 0.29053, 0.40991,
0.11493, 0.10883, -0.36157, 0.14197, 0.30298, 0.19812, 0.81152, -0.19067, -0.05615, -0.31860, 1.11133, -0.16956, -0.64941, -0.10883, 0.94873, -0.28296, 0.05005, -0.50635, -0.08850, -0.95752, 0.18860, 1.37598, -0.20044, -0.04773, 0.01564, -0.63867, 1.10840, 1.13086, 1.43457, 0.47559, -0.03427, 0.08838, -0.11414, 0.08417, -0.32178, 0.87158, -0.25098, -0.15564, 0.92725, -0.06274, -0.06360, -0.23132, -0.45508, -2.25586, -0.59375, 1.70508, 0.42554, -0.08496, 0.03050, -0.42090, -0.14526, -1.95215, -0.64746, 0.07983, 0.64502, -0.05200, 0.04453, 0.09186, -0.20447, 0.63818, 1.70312, -0.49219, -0.47900, -1.16797,
-0.01768, -0.08929, -0.10168, 0.32349, 2.19141, 0.93311, 1.00781, 0.89746, -0.11060, -0.03625, 0.53076, 0.01842, 0.75391, -0.35645, 0.69238, 0.52490, -0.00484, -0.60547, -2.09570, -1.85449, 0.02142, -0.53809, 0.32495, -0.06030, -0.09644, -0.89746, -1.96191, -0.60547, 0.83691, -0.02504, 0.37622, -0.11615, 0.04965, -0.11121, 0.97607, 1.43164, 2.03711, 0.26318, -0.57861, 0.03062, -0.04089, -0.08325, 0.43555, 0.06818, 0.68701, 1.50977, -0.00279, -0.06635, 0.09094, 0.41602, 0.55225, -0.27148, -1.49316, 0.43335, 0.42090, -0.03461, 0.04425, -0.05173, -0.45752, -0.29395, -0.30811, -0.51416, -0.27344, -0.09601,
-0.05334, 0.01700, 1.04297, 0.03873, 0.33350, 1.39062, 0.37549, -0.58008, -0.03369, 0.67578, -1.16895, 0.76123, -0.70508, -0.00906, -1.09473, -0.56738, -0.04977, -0.16089, 2.66016, 0.28125, -2.35156, -0.05820, -1.26172, 0.03802, -0.05365, 0.40430, 0.67920, 0.68799, -0.03836, -1.04297, -0.80273, 0.10986, -0.03366, -0.35352, 0.15503, -0.30518, -1.00391, -0.86865, -0.49561, -0.00451, -0.09277, -1.37988, 1.92188, -0.69824, -0.48779, 0.94385, 1.13477, -0.00700, -0.05338, -0.77881, -0.06143, -0.33691, 0.36060, 1.01953, -0.57324, -0.18420, 0.00887, -0.04105, 0.61035, 0.26343, 0.79297, -1.04297, -1.46387, -1.22461,
0.07794, 0.00176, -0.01445, -0.06268, -0.06555, -0.06055, 0.09296, 0.04251, -0.10144, 0.06921, -0.07996, -0.10590, -0.00072, 0.10876, -0.06085, -0.06909, -0.10486, -0.09723, 0.10803, -0.11560, -0.04825, 0.00210, -0.05334, -0.02776, -0.05438, -0.11188, -0.09479, -0.06836, -0.03915, -0.08289, 0.07428, -0.06219, -0.07776, -0.04376, 0.09961, -0.03876, -0.01968, -0.02928, 0.06088, -0.02156, 0.06671, -0.10742, -0.02910, -0.09009, -0.04370, 0.04730, 0.07941, 0.12341, -0.10364, 0.00566, 0.01866, -0.10754, -0.05191, 0.08380, 0.09521, 0.08972, 0.01100, -0.08453, 0.01029, -0.09875, -0.04947, 0.00497, -0.02650, 0.04956,
0.00195, -0.12189, -0.41431, -0.88477, -0.65625, -0.32080, -1.38672, 0.04764, 0.06763, -1.06543, -1.47461, -0.43335, -1.20605, 0.56494, -0.70117, 0.10895, 0.06195, 0.30688, 0.31885, 0.61719, 1.11230, 2.37305, 0.06665, -0.03357, -0.10754, 0.86328, 0.18457, 1.71680, 0.43726, 0.56396, -0.09692, -0.10724, 0.06989, 0.54785, -0.16077, 0.97705, -0.64160, 0.22070, -0.30493, -0.10260, -0.10797, 0.36499, 1.00488, 1.22363, 1.75195, 0.35400, -1.77051, 0.05521, 0.07910, -0.51611, 0.37134, -0.49683, -0.70996, 0.42529, -1.25977, 0.55713, 0.11340, -0.07605, -0.91309, 0.02895, 0.94824, -0.59961, 0.10822, 0.82178,
-0.01101, 0.08850, 0.06610, -0.41846, 0.65283, -0.31445, -1.63965, -0.08508, 0.08478, 0.22900, 1.32715, -0.20813, 0.00847, 0.55469, 0.72363, 0.10529, 0.09210, 1.28516, -0.26978, -1.39648, 0.20618, 0.66992, 1.01758, -0.12299, 0.09363, -1.52246, -1.62598, -0.84961, -1.25684, -0.24353, -0.50488, -0.03198, 0.00048, -0.34351, -1.77441, 0.93408, 0.17432, -1.22070, -0.66309, -0.00528, 0.04364, 0.07477, 1.59668, -0.38477, -0.66553, 1.00488, -0.43262, -0.05905, 0.10748, 1.18164, 1.12402, -0.34668, 0.43066, 1.51660, 0.51904, -0.45923, 0.12366, -0.05637, -0.05084, 0.65771, 1.60938, 1.00586, 0.46216, 0.28735,
0.06445, 0.12421, -0.83057, -0.05740, 0.13428, -0.39185, -0.31787, -0.04279, -0.00275, -0.45288, -0.92334, -0.21716, -0.88770, -0.42822, -0.54980, 0.05637, -0.02065, -1.13867, -0.02473, -0.33862, -1.33496, -2.95508, 0.33252, 0.01191, -0.07507, -0.03970, 1.31738, 1.65820, 0.52539, 0.08789, -1.10254, -0.10150, -0.00285, -0.81738, 0.02339, 0.70801, 0.80078, -0.49316, -0.72949, 0.06100, 0.04858, -0.59375, 1.92383, 1.49316, 0.47900, 0.30444, 0.00155, 0.10352, -0.06186, -0.19055, 0.41406, 0.58740, -0.27930, 0.69727, -0.03912, 0.13855, 0.02917, 0.00372, -0.71436, -0.36255, 1.20312, 1.08594, 0.37354, 0.19458,
-0.07202, -0.04022, -1.56348, -0.75537, 0.64844, -0.79883, -0.50635, 0.49683, -0.12061, -0.21423, -0.96924, 0.56396, 0.25317, 0.20935, -0.06635, 0.18921, 0.11493, -0.72119, 0.39526, -0.50977, -2.23828, -1.45215, 0.14075, -0.02728, -0.05301, 0.59521, 0.64307, -1.65527, -0.50000, -0.10504, 2.61328, -0.08643, 0.05438, 0.90723, 2.00781, -0.32324, -0.70459, 0.55469, 1.38574, 0.02582, 0.09717, 1.33984, 1.93750, 0.17969, 0.70068, 0.90674, 1.52344, -0.11884, 0.03375, -0.13452, 0.60645, 0.27563, -0.17236, 1.18945, 0.03574, -0.41626, -0.00643, 0.03992, -1.29297, -0.22046, 1.13672, -0.43140, -0.51611, -0.31348,
-0.98389, 0.23804, -0.23962, -2.65430, 1.61523, -0.05069, 0.08557, 1.35449, -1.83203, 2.45898,
2.80664, -0.53564, -0.97949, -0.14722, -0.50879, -0.15491, 2.29102, -0.87695, 2.33203, -2.33984,
0.54492, 0.63818, -3.07227, 0.63818, -0.22644, 0.20215, -0.78467, 3.14648, 0.48975, -1.69531,
1.64160, 1.31348, 0.63232, 1.90527, -0.59570, -0.04156, -0.75732, 0.22693, -0.54395, -1.51562,
-0.66895, 0.52783, 0.10406, -1.21582, -2.73633, -0.11066, 2.40430, -1.57520, 0.19312, 3.51367,
1.15820, 0.16589, 0.77588, -0.44580, 3.38672, 0.16650, -2.46094, -2.19336, 0.47510, -0.57031,
-0.10541, -0.23767, -0.49829, -0.53027, 0.23633, -0.29297, -1.64551, 0.53223, 2.35938, 1.46387,
-1.81934, 0.06445, -0.11249, 3.41797, -1.25586, -0.08081, -0.07434, -1.66602, -2.15820, 0.92676,
-1.91406, -1.82129, 0.42114, 0.34814, 0.54639, 0.23120, 1.26855, 1.26855, 1.19141, -1.36719,
0.06299, -0.56250, 2.85938, -0.87646, -0.54102, -0.00533, 0.05151, 0.01700, -1.81055, -0.10675


]
output_filename = "bfloat16_values.txt"
convert_and_write_to_file(float_values, output_filename)

print(f"bfloat16 hex values written to '{output_filename}'")
